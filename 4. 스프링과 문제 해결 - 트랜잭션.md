# ìŠ¤í”„ë§ì˜ ê°•ì˜ ë¦¬ë·°ğŸ“½

> LoadMap Part : ìŠ¤í”„ë§ DB 1í¸ - ë°ì´í„° ì ‘ê·¼ í•µì‹¬ ì›ë¦¬ - 2022-05-15  
> Section : 4.ìŠ¤í”„ë§ê³¼ ë¬¸ì œí•´ê²° - íŠ¸ëœì­ì…˜   
> CreateDate : 2022.11.01  
> UpdateDate :

## ì‚¬ìš©í•œ ìŠ¤í™

> Spring Boot ë²„ì „ : Spring Boot 2.7.3  
> Java ë²„ì „ : java 11    
> Gradle ë²„ì „: gradle-7.5

<br></br>
<br></br>

# 1. ë¬¸ì œì ë“¤

> ë¨¼ì € ê°€ì¥ ë‹¨ìˆœí•˜ë©´ì„œ ë§ì´ ì‚¬ìš©í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ êµ¬ì¡°ë¥¼ ì•Œì•„ë³´ì

- 3ê°€ì§€ ê³„ì¸µìœ¼ë¡œ ë˜ì–´ìˆë‹¤.

## ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¡°

<p align="center"><img src="https://user-images.githubusercontent.com/104331549/199083658-7a2eacc7-6d27-4d14-a1e0-2a780adb6fcc.png" width="80%"></p>

### í”„ë ˆì  í…Œì´ì…˜ ê³„ì¸µ

- UIì™€ ê´€ë ¨ëœ ì²˜ë¦¬(view)
- ì›¹ ìš”ì²­ê³¼ ì‘ë‹µ(request/response)
- ì‚¬ìš©ì ìš”ì²­ì„ ê²€ì¦(validation)

> ì£¼ ì‚¬ìš© ê¸°ìˆ : ì„œë¸”ë¦¿ê³¼ HTTP ê°™ì€ ì›¹ ê¸°ìˆ , ìŠ¤í”„ë§ MVC

### ì„œë¹„ìŠ¤ ê³„ì¸µ

- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë‹´ë‹¹

> ì£¼ ì‚¬ìš© ê¸°ìˆ : ê°€ê¸‰ì  íŠ¹ì • ê¸°ìˆ ì— ì˜ì¡´í•˜ì§€ ì•Šê³ , ìˆœìˆ˜ ìë°” ì½”ë“œë¡œ ì‘ì„±

### ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ

- ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•˜ëŠ” ì½”ë“œ

> ì£¼ ì‚¬ìš© ê¸°ìˆ : JDBC, JPA, File, Redis, Mongo ...

<br>

## ìˆœìˆ˜í•œ ì„œë¹„ìŠ¤ ê³„ì¸µ

- í•µì‹¬ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ë“¤ì–´ìˆëŠ” ì„œë¹„ìŠ¤ ê³„ì¸µì´ë‹¤
- UI(ì›¹)ì™€ ê´€ë ¨ëœ ë¶€ë¶„ì´ë‚˜, ë°ì´í„° ì €ì¥ ê¸°ìˆ ì€ ë‹¤ë¥¸ ê¸°ìˆ ë¡œ ë³€ê²½í•´ë„, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ìµœëŒ€í•œ ë³€ê²½ì—†ì´ ìœ ì§€ë˜ì–´ì•¼ í•œë‹¤.
- ì¦‰, ì„œë¹„ìŠ¤ ê³„ì¸µì€ íŠ¹ì • ê¸°ìˆ ì— ì¢…ì†ì ì´ì§€ ì•Šê²Œ ê°œë°œí•´ì•¼ëœë‹¤ëŠ” ê²ƒì´ë‹¤.
    - ì´ë ‡ê²Œ ê³„ì¸µì„ ë‚˜ëˆˆ ì´ìœ ë„ ì„œë¹„ìŠ¤ ê³„ì¸µì„ ìµœëŒ€í•œ ìˆœìˆ˜í•˜ê²Œ ìœ ì§€í•˜ê¸° ìœ„í•œ ëª©ì ì´ í¬ë‹¤
    - ê¸°ìˆ ì— ì¢…ì†ì ì¸ ë¶€ë¶„ì€ í”„ë ˆì  í…Œì´ì…˜ ê³„ì¸µ, ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ
        - í”„ë ˆì  í…Œì´ì…˜ ê³„ì¸µ : HTTP APIë¥¼ ì‚¬ìš©í•˜ë‹¤ê°€ GRPCê°™ì€ ê¸°ìˆ ë¡œ ë³€ê²½ë˜ë©´, í•´ë‹¹ ê³„ì¸µ ì½”ë“œë§Œ ë³€ê²½í•˜ë©´ ë¨
        - ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ :  JDBCë¥¼ ì‚¬ìš©í•˜ë‹¤ê°€ JPA ë¡œ ë³€ê²½ë˜ë©´, í•´ë‹¹ ê³„ì¸µë§Œ ë°”ê¾¸ë©´ëœë‹¤.

> ê·¸ëŸ¼ ì–´ë–»ê²Œ ì„œë¹„ìŠ¤ ê³„ì¸µì„ ìˆœìˆ˜í•˜ê²Œ ìœ ì§€í• ê¹Œ?

### MemberServiceV1

- ë§Œë“¤ì–´ë†¨ë˜ ì½”ë“œë¥¼ ë³´ì

```java

@RequiredArgsConstructor
public class MemberServiceV1 {
    private final MemberRepositoryV1 memberRepository;

    public void accountTransfer(String fromId, String toId, int money) throws SQLException { // ì¤‘ìš”í•œ ê³³ì€ ì—¬ê¸°
        Member fromMember = memberRepository.findById(fromId);
        Member toMember = memberRepository.findById(toId);

        memberRepository.update(fromId, fromMember.getMoney() - money);
        validation(toMember);
        memberRepository.update(toId, toMember.getMoney() + money);

    }

    private void validation(Member toMember) {
        if (toMember.getMemberId().equals("ex")) {
            throw new IllegalStateException("ì´ì²´ì¤‘ ì˜ˆì™¸ ë°œìƒ");
        }
    }
}
```

- ì–¸ëœ» ë³´ê¸°ì— íŠ¹ì • ê¸°ìˆ ì— ì¢…ì†ì ì´ì§€ ì•Šê³ , ìˆœìˆ˜í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ìœ¼ë¡œë§Œ ë³´ì¼ ìˆ˜ ìˆì§€ë§Œ,
    - SQLException ì´ë¼ëŠ” JDBC ê¸°ìˆ ì— ì˜ì¡´í•œë‹¤ëŠ” ì ì´ ìˆë‹¤.
    - ì´ ë¶€ë¶„ì€ memberRepository ì—ì„œ ì˜¬ë¼ì˜¤ëŠ” ì˜ˆì™¸ì´ê¸° ë•Œë¬¸ì— memberRepository ì—ì„œ í•´ê²°í•´ì•¼ í•œë‹¤.

### MemberServiceV2

- íŠ¸ëœì­ì…˜ì„ ì´ìš©í•œ `V2` ë²„ì „ë„ íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ `javax.sql.DataSource` , `java.sql.Connection` , `java.sql.SQLException` ê°™ì€ JDBC ê¸°ìˆ ì—
  ì˜ì¡´í•´ì•¼ í•œë‹¤ëŠ” ì ì´ ìˆë‹¤.
- ê²°ê³¼ì ìœ¼ë¡œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë³´ë‹¤ JDBCë¥¼ ì‚¬ìš©í•´ì„œ íŠ¸ëœì­ì…˜ì„ ì²˜ë¦¬í•˜ëŠ” ì½”ë“œê°€ ë” ë§ë‹¤

<br></br>
<br></br>

## ë¬¸ì œ ì •ë¦¬

> ë¬¸ì œì ì„ ì •ë¦¬í•˜ë©´ í¬ê²Œ 3ê°€ì§€ì´ë‹¤.

### 1. íŠ¸ëœì­ì…˜ ë¬¸ì œ

- JDBC êµ¬í˜„ ê¸°ìˆ ì´ ì„œë¹„ìŠ¤ ê³„ì¸µì— ëˆ„ìˆ˜ë˜ëŠ” ë¬¸ì œ
    - íŠ¸ëœì­ì…˜ì„ ì ìš©í•˜ê¸° ìœ„í•´ JDBC êµ¬í˜„ ê¸°ìˆ ì´ ì„œë¹„ìŠ¤ ê³„ì¸µì— ëˆ„ìˆ˜ë˜ì—ˆë‹¤
- íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë¬¸ì œ
    - ê°™ì€ íŠ¸ëœì­ì…˜ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ ì»¤ë„¥ì…˜ì„ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê²¨ì•¼ í•œë‹¤
- íŠ¸ëœì­ì…˜ ì ìš© ë°˜ë³µ ë¬¸ì œ
    - íŠ¸ëœì­ì…˜ ì ìš© ì½”ë“œë¥¼ ë³´ë©´ ë°˜ë³µì´ ë§ë‹¤. try , catch , finally ..

### 2. ì˜ˆì™¸ ëˆ„ìˆ˜ ë¬¸ì œ

- SQLException ì€ JDBC ì „ìš© ê¸°ìˆ ì´ë‹¤
    - JDBC êµ¬í˜„ ê¸°ìˆ  ì˜ˆì™¸ê°€ ì„œë¹„ìŠ¤ ê³„ì¸µìœ¼ë¡œ ì „íŒŒëœë‹¤

### 3. JDBC ë°˜ë³µ ë¬¸ì œ

- ì´ ì½”ë“œë“¤ì€ ìœ ì‚¬í•œ ì½”ë“œì˜ ë°˜ë³µì´ ë„ˆë¬´ ë§ë‹¤
    - try , catch , finally ë°˜ë³µ
    - ì»¤ë„¥ì…˜ì„ ì—´ê³ , PreparedStatement ë¥¼ ì‚¬ìš©í•˜ê³ , ê²°ê³¼ë¥¼ ë§¤í•‘í•˜ê³ ... ì‹¤í–‰, ë‹¤ì‹œ ë°˜ë‚© ë°˜ë³µ

> ê·¸ëŸ¼ ì´ëŸ¬í•œ ë¬¸ì œë“¤ì„ ì–´ë–»ê²Œ í•´ê²°í• ê¹Œ?
> ìŠ¤í”„ë§ì„ ì‚¬ìš©í•´ì„œ ìš°ë¦¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ê°€ì§„ ë¬¸ì œë“¤ì„ í•˜ë‚˜ì”© í•´ê²°í•´ë³´ì.

<br></br>
<br></br>

# íŠ¸ëœì­ì…˜ ì¶”ìƒí™”

- ë¨¼ì € JDBCë¡œ íŠ¸ëœì­ì…˜ êµ¬í˜„í•  ë•Œë‘, JPAë¡œ íŠ¸ëœì­ì…˜ êµ¬í˜„í•  ë•Œ ì–´ë–»ê²Œ ë‹¬ë¼ì§€ëŠ”ì§€ ì•Œì•„ë³´ì

### JDBC íŠ¸ëœì­ì…˜ ì½”ë“œ ì˜ˆì‹œ

```java
public class JDBCServiceCode {
    //.. ìƒëµ
    public void accountTransfer(String fromId, String toId, int money) throws SQLException {
        Connection con = dataSource.getConnection();
        try {
            con.setAutoCommit(false); //íŠ¸ëœì­ì…˜ ì‹œì‘
            //ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
            bizLogic(con, fromId, toId, money);
            con.commit(); //ì„±ê³µì‹œ ì»¤ë°‹
        } catch (Exception e) {
            con.rollback(); //ì‹¤íŒ¨ì‹œ ë¡¤ë°±
            throw new IllegalStateException(e);
        } finally {
            release(con);
        }
    }
}
```

### JDBC íŠ¸ëœì­ì…˜ ì½”ë“œ ì˜ˆì‹œ

```java
public class JPAServiceCode {
    //.. ìƒëµ
    public static void main(String[] args) {
        EntityManagerFactory emf = Persistence.createEntityManagerFactory("jpabook"); //ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬ ìƒì„±
        EntityManager em = emf.createEntityManager(); //ì—”í‹°í‹° ë§¤ë‹ˆì € ìƒì„±
        EntityTransaction tx = em.getTransaction(); //íŠ¸ëœì­ì…˜ ê¸°ëŠ¥ íšë“
        try {
            tx.begin(); //íŠ¸ëœì­ì…˜ ì‹œì‘
            logic(em); //ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
            tx.commit();//íŠ¸ëœì­ì…˜ ì»¤ë°‹
        } catch (Exception e) {
            tx.rollback(); //íŠ¸ëœì­ì…˜ ë¡¤ë°±
        } finally {
            em.close(); //ì—”í‹°í‹° ë§¤ë‹ˆì € ì¢…ë£Œ
        }
        emf.close(); //ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬ ì¢…ë£Œ
    }
}
```

> ì´ë ‡ê²Œ íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ì½”ë“œëŠ” ë°ì´í„° ì ‘ê·¼ ê¸°ìˆ ë§ˆë‹¤ ë‹¤ë¥´ë‹¤.  
> ê·¸ë ‡ê¸° ë–„ë¬¸ì— ê¸°ìˆ ì„ ë°”ê¾¸ê²Œë˜ë©´, ì„œë¹„ìŠ¤ê³„ì¸µë„ ë°”ê¿”ì•¼ë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤.
> ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ë©´ íŠ¸ëœì­ì…˜ ê¸°ëŠ¥ì„ ì¶”ìƒí™”í•˜ë©´ ëœë‹¤

## íŠ¸ëœì­ì…˜ ì¶”ìƒí™” ì¸í„°í˜ì´ìŠ¤

- ê²°êµ­, íŠ¸ëœì­ì…˜ì€ ì‹œì‘í•˜ê³ , ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ìˆ˜í–‰ì´ ëë‚˜ë©´ ì»¤ë°‹í•˜ê±°ë‚˜ ë¡¤ë°±í•˜ë©´ ëœë‹¤

```java
public interface TxManager {
    begin(); // ì‹œì‘

    commit(); // ì»¤ë°‹

    rollback(); // ë¡¤ë°±
}
```

- ê·¸ë¦¬ê³  ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê°ê°ì˜ ê¸°ìˆ ì— ë§ëŠ” êµ¬í˜„ì²´ë¥¼ ë§Œë“¤ë©´ëœë‹¤.
- ìŠ¤í”„ë§ì€ ì´ë¯¸ ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•  ì¸í„°í˜ì´ìŠ¤ì™€ êµ¬í˜„ì²´ë¥¼ ë‹¤ í•´ë‘ì—ˆë‹¤.
- ìš°ë¦¬ëŠ” ê°€ì ¸ë‹¤ ì‚¬ìš©í•˜ê¸°ë§Œí•˜ë©´ ëœë‹¤.

<p align="center"><img src="https://user-images.githubusercontent.com/104331549/199321264-ccfdecf5-07bd-49a0-9b4d-a9f7889823b3.png" width="80%"></p>

- ìŠ¤í”„ë§ íŠ¸ëœì­ì…˜ ì¶”ìƒí™”ì˜ í•µì‹¬ì€ `PlatformTransactionManager` ì¸í„°í˜ì´ìŠ¤ì´ë‹¤.
    - `org.springframework.transaction.PlatformTransactionManager`

<br></br>
<br></br>

# íŠ¸ëœì­ì…˜ ë™ê¸°í™”

> ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ëŠ” í¬ê²Œ 2ê°€ì§€ ì—­í• ì„ í•œë‹¤.

- ìœ„ì—ì„œ ì–¸ê¸‰í•œ íŠ¸ëœì­ì…˜ ì¶”ìƒí™”
- ë¦¬ì†ŒìŠ¤ ë™ê¸°í™”

### ë¦¬ì†ŒìŠ¤ ë™ê¸°í™”

- íŠ¸ëœì­ì…˜ì„ ìœ ì§€í•˜ë ¤ë©´ íŠ¸ëœì­ì…˜ì˜ ì‹œì‘ë¶€í„° ëê¹Œì§€ ê°™ì€ ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ì„ ìœ ì§€í•´ì•„í•œë‹¤.
    - ì´ì „ì—ëŠ” íŒŒë¼ë¯¸í„°ë¡œ ì»¤ë„¥ì…˜ì„ ì „ë‹¬í•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©í–ˆë‹¤.
- ìŠ¤í”„ë§ì€ ì´ê²ƒì„ ì“°ë ˆë“œ ë¡œì»¬(`ThreadLocal`)ì„ ì‚¬ìš©í•´ì„œ ì»¤ë„¥ì…˜ì„ ë™ê¸°í™” í•´ì¤€ë‹¤.
    - ì“°ë ˆë“œ ë¡œì»¬ì„ ì‚¬ìš©í•˜ë©´ ê°ê°ì˜ ì“°ë ˆë“œë§ˆë‹¤ ë³„ë„ì˜ ì €ì¥ì†Œê°€ ë¶€ì—¬ëœë‹¤. ë”°ë¼ì„œ í•´ë‹¹ ì“°ë ˆë“œë§Œ í•´ë‹¹ ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
    - ì—¬ê¸°ì„œ ì“°ë ˆë“œ ë¡œì»¬ì€ ì¤‘ìš”í•˜ë‹ˆê¹Œ, ë”°ë¡œ ë‹¤ë£¨ê¸°ë¡œ í•˜ì.

<p align="center"><img src="https://user-images.githubusercontent.com/104331549/199325949-8126f1e5-729c-4170-a0df-fa9fdad8d3d8.png" width="80%"></p>

- ì»¤ë„¥ì…˜ì´ í•„ìš”í•˜ë©´ íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ë¥¼ í†µí•´ ì»¤ë„¥ì…˜ì„ íšë“í•˜ë©´ ëœë‹¤

## íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €

- `org.springframework.transaction.support.TransactionSynchronizationManager`
- íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì € í´ë˜ìŠ¤ë¥¼ ì—´ì–´ë³´ë©´ ì“°ë ˆë“œ ë¡œì»¬ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

<br></br>
<br></br>

# íŠ¸ëœì­ì…˜ ë¬¸ì œ í•´ê²° - íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €1

- `DataSourceUtils`ìœ¼ë¡œ ì»¤ë„¥ì…˜ ìƒì„±ê³¼ ë‹«ìŒì„ ì²˜ë¦¬í•˜ë©´, ì»¤ë„¥ì…˜ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•´ì•¼ë˜ëŠ” ë¬¸ì œë¥¼ ë™ê¸°í™”ë¡œ í•´ê²°í•  ìˆ˜ ìˆë‹¤.
    - DataSourceUtils.getConnection(dataSource)  - ì»¤ë„¥ì…˜ ì—°ê²°
    - DataSourceUtils.releaseConnection(ì»¤ë„¥ì…˜, dataSource)
        - JdbcUtils.closeConnection(con);ë¡œ ë‹«ì•„ì£¼ë©´ ì•ˆëœë‹¤.

## DataSourceUtils.getConnection()

- íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ê°€ ê´€ë¦¬í•˜ëŠ” ì»¤ë„¥ì…˜ì´ ìˆìœ¼ë©´ í•´ë‹¹ ì»¤ë„¥ì…˜ì„ ë°˜í™˜í•œë‹¤
- íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ê°€ ê´€ë¦¬í•˜ëŠ” ì»¤ë„¥ì…˜ì´ ì—†ëŠ” ê²½ìš° ìƒˆë¡œìš´ ì»¤ë„¥ì…˜ì„ ìƒì„±í•´ì„œ ë°˜í™˜í•œë‹¤
- DataSourceUtils ì½”ë“œë¥¼ ë³´ë©´ ì•„ë˜ì™€ ê°™ë‹¤.
    - ì»¤ë„¥ì…˜ì„ ë°›ì•„ì˜¤ëŠ” `getConnection()`ë©”ì†Œë“œ ì½”ë“œë¥¼ ë³´ë©´ `doGetConnection(dataSource)`ë¥¼ ì‹¤í–‰í•œë‹¤.

### DataSourceUtils.java

```java
package org.springframework.jdbc.datasource;

public abstract class DataSourceUtils {
    //.. ì´í•˜ ìƒëµ
    public static Connection getConnection(DataSource dataSource) throws CannotGetJdbcConnectionException {
        try {
            // ì—¬ê¸°ê°€ ì¤‘ìš”!
            return doGetConnection(dataSource);

        } catch (SQLException ex) {
            throw new CannotGetJdbcConnectionException("Failed to obtain JDBC Connection", ex);
        } catch (IllegalStateException ex) {
            throw new CannotGetJdbcConnectionException("Failed to obtain JDBC Connection: " + ex.getMessage());
        }
    }

    // doGetConnection() ë©”ì†Œë“œ
    public static Connection doGetConnection(DataSource dataSource) throws SQLException {
        Assert.notNull(dataSource, "No DataSource specified");
        //ì—¬ê¸°ì„œ ë™ê¸°í™” ë§¤ë‹ˆì €ì—ì„œ ì»¤ë„¥ì…˜ì„ ê°€ì ¸ì˜¤ëŠ” ê±¸ ì•Œ ìˆ˜ ìˆë‹¤. 
        //TransactionSynchronizationManager = íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €
        ConnectionHolder conHolder = (ConnectionHolder) TransactionSynchronizationManager.getResource(dataSource);
        if (conHolder != null && (conHolder.hasConnection() || conHolder.isSynchronizedWithTransaction())) {
            conHolder.requested();
        }
        // ì´í•˜ ìƒëµ
    }
}
```

<br></br>

## DataSourceUtils.releaseConnection()

- ì»¤ë„¥ì…˜ì„ con.close() ë¥¼ ì‚¬ìš©í•´ì„œ ì§ì ‘ ë‹«ì•„ë²„ë¦¬ë©´ ì»¤ë„¥ì…˜ì´ ìœ ì§€ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤.
    - ì´ ì»¤ë„¥ì…˜ì€ ì´í›„ ë¡œì§ì€ ë¬¼ë¡ ì´ê³ , íŠ¸ëœì­ì…˜ì„ ì¢…ë£Œ(ì»¤ë°‹, ë¡¤ë°±)í•  ë•Œ ê¹Œì§€ ì‚´ì•„ìˆì–´ì•¼ í•œë‹¤.
- DataSourceUtils.releaseConnection() ì„ ì‚¬ìš©í•˜ë©´ ì»¤ë„¥ì…˜ì„ ë°”ë¡œ ë‹«ëŠ” ê²ƒì´ ì•„ë‹ˆë‹¤.
    - íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë™ê¸°í™”ëœ ì»¤ë„¥ì…˜ì€ ì»¤ë„¥ì…˜ì„ ë‹«ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ìœ ì§€í•´ì¤€ë‹¤.
    - íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ê°€ ê´€ë¦¬í•˜ëŠ” ì»¤ë„¥ì…˜ì´ ì—†ëŠ” ê²½ìš° í•´ë‹¹ ì»¤ë„¥ì…˜ì„ ë‹«ëŠ”ë‹¤.

### DataSourceUtils.java

```java
package org.springframework.jdbc.datasource;

public abstract class DataSourceUtils {
    //.. ì´í•˜ ìƒëµ

    public static void releaseConnection(@Nullable Connection con, @Nullable DataSource dataSource) {
        try {
            // ì—¬ê¸°ê°€ ì¤‘ìš”!    
            doReleaseConnection(con, dataSource);

        } catch (SQLException ex) {
            logger.debug("Could not close JDBC Connection", ex);
        } catch (Throwable ex) {
            logger.debug("Unexpected exception on closing JDBC Connection", ex);
        }
    }

    //doReleaseConnection() ë©”ì†Œë“œ
    public static void doReleaseConnection(@Nullable Connection con, @Nullable DataSource dataSource) throws SQLException {
        if (con == null) {
            return;
        }
        if (dataSource != null) {
            //ì—¬ê¸°ì„œ ì»¤ë„¥ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ì—ì„œ ì»¤ë„¥ì…˜ì„ ê°€ì ¸ì˜¤ëŠ” ê±¸ ì•Œ ìˆ˜ ìˆë‹¤. 
            ConnectionHolder conHolder = (ConnectionHolder) TransactionSynchronizationManager.getResource(dataSource);
            if (conHolder != null && connectionEquals(conHolder, con)) {
                // It's the transactional Connection: Don't close it.
                // ë§Œì•½ ì»¤ë„¥ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ì—ì„œ ê´€ë¦¬í•˜ëŠ” ì»¤ë„¥ì…˜ì´ë¼ë©´ ë‹«ì„ ìˆ˜ ì—†ë‹¤.
                conHolder.released();
                return;
            }
        }
        doCloseConnection(con, dataSource);
    }
}
```
## ì„œë¹„ìŠ¤
 - ì´ì œ JDBCì˜ ê¸°ìˆ ì¸ DataSourceë¥¼ ì§ì ‘ ì ìš©í•˜ì§€ì•Šê³  ì¶”ìƒí™”í•  ìˆ˜ ìˆëŠ” ì¸í„°í˜ì´ìŠ¤ `PlatformTransactionManager`ë¡œ ë„£ìœ¼ë©´ëœë‹¤.
   - DIê°€ ì ìš©ë˜ê¸° ë•Œë¬¸ì—, JDBCì— ì˜ì¡´í•˜ì§€ ì•Šê²Œ ëœë‹¤. 
 - ê²Œë‹¤ê°€ ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ, ì»¤ë„¥ì…˜ì„ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•˜ì§€ë„ ì•Šê²Œ ëœë‹¤.
 - ë˜í•œ, ë¦´ë¦¬ì¦ˆì²˜ë¦¬ë„ ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ í•„ìš”ì—†ê²Œ ëœë‹¤.(ë§¤ë‹ˆì €ê°€ í•´ì¤Œ) 
### ì°¸ê³  ì½”ë“œ
- [íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¥¼ ì„œë¹„ìŠ¤ê³„ì¸µ MemberServiceV3_1.java ì½”ë“œ ë³´ê¸°](/practice_code/service/MemberServiceV3_1.java)

## í…ŒìŠ¤íŠ¸





<p align="center"><img src="" width="80%"></p>


<a name=""></a>
<br></br>
<br></br>

## ëŠë‚€ì  ğŸ˜Œ

### ì°¸ê³  ë§í¬